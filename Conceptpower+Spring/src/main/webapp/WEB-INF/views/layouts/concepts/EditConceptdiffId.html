<html
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
   layout:decorate="~{layouts/main}"
   >
   
   <head>
	   <script>
	    $(function() {
	        $(document).ready(function() {
	            var term = $('#term').val();
	            if (term != '') {
	                var synonymDescription = $('#synonymDescription').val();
	                var id = $('#synonymId').val();
	                var termArray = term.split(',,');
	                var synonymDescriptionArray = synonymDescription.split(',,');
	                var idArray = id.split(',,');
	                for (var i = 0; i < termArray.length; i++) {
	                    if (idArray[i] != '') {
	                        synonymAdd(idArray[i], termArray[i], synonymDescriptionArray[i], 'true');
	                    }
	                }
	            }
	        });
	        $("#synonymModal").dialog({
	            autoOpen : false
	        });
	    });
	    $(function() {
	        $("#addsynonym").click(function() {
	            var addedSynonymsTable = $('#addedSynonyms');
	            $('#synonymstable').dataTable().fnClearTable();
	            $("#synonymModal").dialog('open');
	            $("#synonymsDialogTable").show();
	        });
	        $("#name").on(
	                "change paste",
	                function() {
	                    $.ajax({
	                        type : "GET",
	                        url : "/conceptpower/getExistingConcepts",
	                        data : {
	                            conceptname : $(this).val()
	                        },
	                        success : function(response) {
	                            var data = jQuery.parseJSON(response);
	                            if (data.length > 0) {
	                                var text = "Following concepts have the same name : \n";
	                                var len = data.length;
	                                for (var i = 0; i < len; i++) {
	                                    text += (data[i].word + " - " + data[i].description + "\n");
	                                }
	                                $("#warning").show();
	                                $('#warning').prop('title', text);
	                            } else {
	                                $("#warning").hide();
	                                $('#warning').prop('title', '');
	                            }
	                        },

	                        error : function(httpStatus, response) {
	                            if (httpStatus.status == 409) {
	                                var errorMessage = "<i class=\"fa fa-exclamation-triangle\">"
	                                        + httpStatus.responseText + "</i>";
	                                $("#synonymModal").dialog("close");
	                                $('#synonymModal').modal('toggle');
	                                $('#errorMessage').show();
	                                $('#error_alert_msg').html(errorMessage);
	                            }
	                        }
	                    });
	                });
	    });
	    $(document).ready(definedatatable);
	    function definedatatable() {
	        $('#synonymstable').dataTable(
	                {
	                    "bJQueryUI" : true,
	                    "sPaginationType" : "full_numbers",
	                    "bAutoWidth" : false,
	                    "bStateSave" : true,
	                    "aoColumns" : [ {
	                        "sTitle" : "Term",
	                        "mDataProp" : "word",
	                    }, {
	                        "sTitle" : "POS",
	                        "mDataProp" : "pos",
	                    }, {
	                        "sTitle" : "Description",
	                        "mDataProp" : "description",
	                    }, {
	                        "sTitle" : "Add",
	                        "mDataProp" : "id"
	                    } ],
	                    "fnRowCallback" : function(nRow, aData, iDisplayIndex) {
	                        var description = aData.description;
	                        description = description != null ? description.replace(/"/g, '&quot;')
	                                : "";
	                        $('td:eq(3)', nRow).html(
	                                '<a onclick="synonymAdd(\'' + aData.id + '\',\'' + aData.word
	                                        + '\',\'' + description + '\')">Add</a>');
	                        return nRow;
	                    }
	                });
	    };
	    $(function() {
	        $("#synonymsearch").click(
	                function() {
	                    $("#synonymViewDiv").show();
	                    $("#synonymstable").show();
	                    var addedsynonym = $('#addedSynonnym').val();
	                    var synonymname = $("#synonymname").val();
	                    $.ajax({
	                        type : "GET",
	                        url : "/conceptpower/conceptAddSynonymView",
	                        data : {
	                            synonymname : synonymname,
	                            addedsynonym : addedsynonym
	                        },
	                        success : function(response) {
	                            var data = jQuery.parseJSON(response);
	                            $('#synonymstable').dataTable().fnClearTable();
	                            $('#synonymstable').dataTable().fnAddData(data);
	                        },
	                        error : function(httpStatus, response) {
	                            if (httpStatus.status == 409) {
	                                var errorMessage = "<i class=\"fa fa-exclamation-triangle\">"
	                                        + httpStatus.responseText + "</i>";
	                                $("#synonymModal").dialog("close");
	                                $('#synonymModal').modal('toggle');
	                                $('#errorMessage').show();
	                                $('#error_alert_msg').html(errorMessage);
	                            }
	                        }
	                    });
	                });
	    });
	    var synonymAdd = function(id, term, description, onLoad) {
	        if (typeof onLoad === "undefined") {
	            onLoad = false;
	        }
	        if (onLoad == false) {
	            $("#dialog").dialog("close");
	            $("#synonymModal").dialog("close");
	            $('#synonymModal').modal('toggle');
	            $("#synonymsDialogTable").hide();
	        }
	        var x = document.getElementById('addedSynonymsTable');
	        var addedsynonym = $('#addedSynonnym').val();
	        if (x != null) {
	            var new_row = x.rows[0].cloneNode(true);
	            new_row.cells[0].innerHTML = '<a onclick="synonymRemove(\'' + x.rows.length
	                    + '\')">Remove</a>' + '</font></td>'
	            new_row.cells[1].innerHTML = term;
	            new_row.cells[2].innerHTML = description;
	            new_row.cells[3].innerHTML = id;
	            new_row.cells[3].hidden = true;
	            if (onLoad == false) {
	                var t = $('#term').val();
	                t = t + ",," + term;
	                $('#term').val(t);
	                var d = $('#synonymDescription').val();
	                d = d + ",," + description;
	                $('#synonymDescription').val(d);
	                var i = $('#synonymId').val();
	                i = i + ",," + id;
	                $('#synonymId').val(i);
	            }
	            x.appendChild(new_row);
	            addedsynonym += ','
	            addedsynonym += id;
	            $('#addedSynonnym').val(addedsynonym);
	        } else {
	            var html = '<table border="1" width="400" id="addedSynonymsTable"><thead></thead>';
	            html += '<tr><td align="justify"><font size="2">'
	                    + '<a onclick="synonymRemove(\'0\')">Remove</a>' + '</font></td>';
	            html += '<td align="justify"><font size="2">' + term + '</font></td>';
	            html += '<td align="justify"><font size="2">' + description + '</font></td>';
	            html += '<td align="justify" hidden="true">' + id + '</td></tr>';
	            html += '</table>';
	            html += '<input type="hidden" name="syns" />';
	            addedsynonym += id;
	            if (onLoad == false) {
	                $('#term').val(term);
	                $('#synonymDescription').val(description);
	                $('#synonymId').val(id);
	            }
	            $('#addedSynonnym').val(addedsynonym);
	            $("#addedSynonyms").html(html);
	        }
	        var synonyms = " ";
	        var table = document.getElementById('addedSynonymsTable');
	        for (var r = 0, n = table.rows.length; r < n; r++) {
	            synonyms += table.rows[r].cells[3].innerHTML + ',';
	        }
	        $("#synonymsids").val(synonyms);
	    };
	    var synonymRemove = function(row) {
	        bindingRemoval(row);
	        $('#addedSynonnym').val('');
	        var x = document.getElementById('addedSynonymsTable');
	        x.deleteRow(row);
	        if (!(x.rows.length > 0))
	            x.parentNode.removeChild(x);
	        var synonyms = " ";
	        var table = document.getElementById('addedSynonymsTable');
	        for (var r = 0, n = table.rows.length; r < n; r++) {
	            synonyms += table.rows[r].cells[3].innerHTML + ',';
	        }
	        $("#synonymsids").val(synonyms);
	        $('#addedSynonnym').val(synonyms);
	    };
	    var bindingRemoval = function(row) {
	        var ids = $('#synonymId').val();
	        var idArray = ids.split(',,');
	        var newIdArray = '';
	        for (var i = 0; i < idArray.length; i++) {
	            if (i != row) {
	                newIdArray = newIdArray + idArray[i];
	                newIdArray = newIdArray + ',,';
	            }
	        }
	        $('#synonymId').val(newIdArray);
	        var synonymDescriptions = $('#synonymDescription').val();
	        var synonymDescriptionArray = synonymDescriptions.split(',,');
	        var newSynonymArray = '';
	        for (var i = 0; i < synonymDescriptionArray.length; i++) {
	            if (i != row) {
	                newSynonymArray = newSynonymArray + synonymDescriptionArray[i];
	                newSynonymArray = newSynonymArray + ',,';
	            }
	        }
	        $('#synonymDescription').val(newSynonymArray);
	        var terms = $('#term').val();
	        var termArray = terms.split(',,');
	        var newTermArray = '';
	        for (var i = 0; i < termArray.length; i++) {
	            if (i != row) {
	                newTermArray = newTermArray + termArray[i];
	                newTermArray = newTermArray + ',,';
	            }
	        }
	        $('#term').val(newTermArray);
	    }
	    
	    
	    var serviceConceptAdd = function(serviceConceptID, name) {
	        var check = false;
	        if (document.getElementById(serviceConceptID).checked) {
	            $('#equals').val(serviceConceptID);
	            document.getElementById("name").value = decodeURI(name);
	            check = true;
	        } else if (!(document.getElementById(serviceConceptID).checked)) {
	            $('#equals').val('');
	            document.getElementById("name").value = '';
	            check = false;
	        }
	        var checkboxes = new Array();
	        checkboxes = document.getElementsByTagName('input');
	        for (var i = 0; i < checkboxes.length; i++) {
	            if (checkboxes[i].type == 'checkbox') {
	                checkboxes[i].checked = false;
	            }
	        }
	        if (check)
	            document.getElementById(serviceConceptID).checked = true;
	        else
	            document.getElementById(serviceConceptID).checked = false;
	    };
	    
	    $(document).ready(function() { 
	        $('#createconceptform').submit(function(event) {
	            var ret = true;
	            if ($("#name").val() === "") {
	                $("#nameerror").html('Please enter a name for concept.');
	                hideFormProcessing();
	                ret = false;
	            } else {
	                $("#nameerror").html('');
	            }
	            if ($("#pos").val() === "") {
	                $("#poserror").html('Please select a pos.');
	                hideFormProcessing();
	                ret = false;
	            } else {
	                $("#poserror").html('');
	            }
	            if ($("#selectedList").val() === "") {
	                $("#listerror").html('Please select a concept list.');
	                hideFormProcessing();
	                ret = false;
	            } else {
	                $("#listerror").html('');
	            }
	            if ($("#selectedTypes").val() === "") {
	                $("#typeerror").html('Please select a concept type.');
	                hideFormProcessing();
	                ret = false;
	            } else {
	                $("#typeerror").html('');
	            }
	            return ret;
	        });    
	    });
	    
	    $(document).ready(showAjaxProcessing);
	    function showAjaxProcessing() {
	        var $loading = $('#loadingDiv').hide();
	        $(document).ajaxStart(function() {
	            $loading.show();
	        }).ajaxStop(function() {
	            $loading.hide();
	        });
	    }
	    $(document).ready(hideFormProcessing);
	    function hideFormProcessing() {
	        $('#loadingDiv').hide();
	    }
	    function showFormProcessing() {
	        $('#loadingDiv').show();
	    }	    
	   </script>
   </head>
   
   <body class="body" layout:fragment="content">
      <div class="newConcept">
      <h3 class="title">Edit concept</h3>
      <form
         th:action="@{/auth/conceptlist/editconcept/edit/'+${conceptId}}"
         th:object="${conceptEditBean}" method='post'
         id="createconceptform">
         <div id="serviceResult"
            style="max-width: 1000px; padding: 15px;"
            hidden="true"
            >
            <table cellpadding="0" cellspacing="0"
               class="table table-striped table-bordered"
               id="serviceResultTable" hidden="true">
               <tbody>
               </tbody>
            </table>
         </div>
         <table class="conceptForm">
            <tbody>
               <tr>
                  <td style="width:172px;">
                     <label for="name" class="formlabel">Concept</label>
                  </td>
                  <td>
                     <input type="text" class="form-control" name="name" th:value="${conceptEditBean.word}">
                  </td>
               </tr>
               <tr>
                  <td style="width:172px;">
                     <label for="pos" class="formlabel">POS</label>
                  </td>
                  <td class="drpSpacing">
                     <div>
		               <select class="selectDropdown" th:name="pos">
		                  <option th:each="entry: ${conceptEditBean.posMap}" th:value="${entry.key}" th:text="${entry.value}">
		                  </option>
		               </select>
		               <i class="fa fa-caret-down" aria-hidden="true"></i>
		            </div>
                  </td>
               </tr>
               <tr>
                  <td style="width:172px;">
                     <div>
                        <label for="selectedList" class="formlabel">Concept List</label>
                  </td>
                  <td class="drpSpacing">
                        <div class="selectDropdown">
                           <select th:name="selectedList" class="POS">
	                              <option th:each="item: ${conceptEditBean.conceptList}" th:value="${conceptEditBean.selectedListName}" th:text="${conceptEditBean.selectedListName}">
	                              </option>
                           </select>
                           <i class="fa fa-caret-down" aria-hidden="true"></i>
                        </div>
                     </div>
                  </td>
               </tr>
               <tr>
                  <td style="width:172px;">
                     <label for="description" class="formlabel">Description</label>
                  </td>
                  <td>
                     <textarea class="form-control" name="description" rows="3" th:text="${conceptEditBean.description}"></textarea>
                  </td>
               </tr>
               <tr>
                  <td style="width:172px;">
                     <label for="synonym" class="formlabel">Synonyms</label>
                  </td>
                  <td>
                     <button class="btn btn-outline-success my-2 my-sm-0 mergeConceptBtn" id="addsynonym" name="synonym" type="button" data-toggle="modal" data-target="#synonyms">
                     <i class="fa fa-plus" aria-hidden="true"></i> Add Synonym	
                     </button>
                  </td>
                  <td>
                     <div id="addedSynonyms">
	                     <table border="1" width="400" id="addedSynonymsTable" hidden="true" class="table table-striped table-bordered">
	                        <tbody>
	                        </tbody>
	                     </table>
                     </div>
                  </td>
               </tr>
               <tr>
                  <td style="width:172px;">
                     <label for="selectedTypes" class="formlabel">Concept Type</label>
                  </td>
                  <td class="drpSpacing">
                     <div class="selectDropdown">
                        <select class="POS">
                           <option th:each="type: ${conceptEditBean.types}" th:value="${type.typeId}" th:text="${type.typeName}">
	                       </option>
                        </select>
                        <i class="fa fa-caret-down" aria-hidden="true"></i>
                     </div>
                  </td>
               </tr>
               <tr>
                  <td style="width:300px;">
                     <label for="equals" class="formlabel">External Authority Service Links</label>
                  </td>
                  <td>
                     <textarea class="form-control" id="equals" name="equals" rows="3" th:text="${conceptEditBean.equals}"></textarea>
                  </td>
               </tr>
               <tr>
                  <td style="width:300px;">
                     <label for="similar" class="formlabel">Links to other services</label>
                  </td>
                  <td>
                     <textarea class="form-control" name="similar" rows="3" th:text="${conceptEditBean.similar}"></textarea>
                  </td>
                  <td>
                     <input type="hidden" id="synonymsids"/>
                     <input type="hidden" id="term"/>
                     <input type="hidden" id="synonymDescription"/>
                     <input type="hidden" id="synonymId"/>
                  </td>
               </tr>
            </tbody>
         </table>
         <div class="sectionHeading">
            <h4 class="numeration">1</h4>
            <label class="formlabel">Search for WordNet concept</label>
         </div>
         <div style="margin-bottom: 100px;">
            <div class="formlabel row">
               <label style="width: 300px;">Create wrapper for concept</label>
               <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="Enter wrapper....">
            </div>
            <div class="row1-2">
               <label for="exampleFormControlInput1" class="formlabel">POS</label>
               <div>
	               <select class="selectDropdown" th:name="pos">
	                  <option> Test
	                  </option>
	               </select>
	               <i class="fa fa-caret-down" aria-hidden="true"></i>
               </div>
               <button class="btn btn-outline-success my-2 my-sm-0 mergeConceptBtn" style="margin: 0;" type="submit">
               Search
               </button>
            </div>
         </div>
         <div class="btnCenter">
            <a th:href="@{/auth/conceptlist}"><button class="btn btn-outline-success my-2 my-sm-0 cancelTypeBtn" type="button" >
            Cancel
            </button></a>
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit"  th:onclick="'showFormProcessing()'"
               th:onsubmit="'hideFormProcessing()'" id="addConceptTypeBtn">
            Save changes
            </button>
         </div>
      </form>
      </div>
      <div th:insert="layouts/modals/Synonyms :: synonyms"></div>
   </body>
</html>
